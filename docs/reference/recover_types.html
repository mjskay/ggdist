<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Decorate a model fit or samples with data types recovered from the input data — recover_types â€¢ tidybayes</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">


<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script>
<script src="../pkgdown.js"></script>
  <link href="../extra.css" rel="stylesheet">
  
<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Google analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-93322-5', 'auto');
  ga('send', 'pageview');

</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">tidybayes</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="..//index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/tidybayes.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/tidy-brms.html">Extracting and visualizing tidy samples from brms</a>
    </li>
    <li>
      <a href="../articles/tidy-rstanarm.html">Extracting and visualizing tidy samples from rstanarm</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/mjskay/tidybayes">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

      <div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Decorate a model fit or samples with data types recovered from the input data</h1>
    </div>

    
    <p>Decorate the samples returned from a Bayesian sampler with types for
variable and index data types. Meant to be used before calling
<code><a href='spread_samples.html'>spread_samples</a></code> or <code><a href='spread_samples.html'>gather_samples</a></code> so that the values returned by
those functions are translated back into useful data types.</p>
    

    <pre class="usage"><span class='fu'>recover_types</span>(<span class='no'>model</span>, <span class='no'>...</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a> Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>model</th>
      <td><p>A supported Bayesian model fit / MCMC object. Currently
supported models include <code><a href='http://www.rdocumentation.org/packages/coda/topics/mcmc'>mcmc</a></code>, <code><a href='http://www.rdocumentation.org/packages/coda/topics/mcmc.list'>mcmc.list</a></code>,
<code><a href='http://www.rdocumentation.org/packages/runjags/topics/runjags'>runjags</a></code>, <code><a href='http://www.rdocumentation.org/packages/rstan/topics/stanfit-class'>stanfit</a></code>, <code><a href='http://www.rdocumentation.org/packages/rstanarm/topics/stanreg-objects'>stanreg-objects</a></code>,
<code><a href='http://www.rdocumentation.org/packages/brms/topics/brm'>brm</a></code>, and anything with its own <code><a href='http://www.rdocumentation.org/packages/coda/topics/mcmc.list'>as.mcmc.list</a></code> implementation.
If you install the <code>tidybayes.rethinking</code> package (available at
<a href='https://github.com/mjskay/tidybayes.rethinking'>https://github.com/mjskay/tidybayes.rethinking</a>), <code>map</code> and
<code>map2stan</code> models from the <code>rethinking</code> package are also supported.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Lists (or data frames) providing data prototypes used to convert
columns returned by <code><a href='spread_samples.html'>spread_samples</a></code> and <code><a href='spread_samples.html'>gather_samples</a></code> back into useful data types.
See `Details`.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A decorated version of <code>model</code>.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>Each argument in <code>...</code> specifies a list or data.frame. The <code>model</code>
is decorated with a list of constructors that can convert a numeric column
into the data types in the lists in <code>...</code>.</p>
<p>Then, when <code><a href='spread_samples.html'>spread_samples</a></code> or <code><a href='spread_samples.html'>gather_samples</a></code> is called on the decorated
<code>model</code>, each list entry with the same name as the variable or an index
in varible_spec is a used as a prototype for that variable or index ---
i.e., its type is taken to be the expected type of that variable or index.
Those types are used to translate numeric values of variables back into
useful values (for example, levels of a factor).</p>
<p>The most common use of <code>recover_types</code> is to automatically translate
indices that correspond to levels of a factor in the original data back into
levels of that factor. The simplest way to do this is to pass in the data
frame from which the original data came.</p>
<p>Supported types of prototypes are factor, ordered, and logical. For example:</p><ul>
<li><p>if <code>prototypes$v</code> is a factor, the v column in the
returned samples is translated into a factor using <code>factor(v,
labels=levels(prototypes$v), ordered=is.ordered(prototypes$v))</code>.</p></li>
<li><p>if
<code>prototypes$v</code> is a logical, the v column is translated into a logical
using <code>as.logical(v)</code>.</p></li>
</ul>
    <p>Additional data types can be supported by providing a custom implementation
of the generic function <code>as_constructor</code>.</p>
    
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <p><code><a href='spread_samples.html'>spread_samples</a></code>, <code><a href='spread_samples.html'>gather_samples</a></code>, <code><a href='compose_data.html'>compose_data</a></code>.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='fu'>library</span>(<span class='no'>dplyr</span>)
<span class='fu'>library</span>(<span class='no'>magrittr</span>)
<span class='fu'>library</span>(<span class='no'>rstan</span>)

<span class='co'># Here's an example dataset with a categorical predictor (`condition`) with several levels:</span>
<span class='fu'>set.seed</span>(<span class='fl'>5</span>)
<span class='no'>n</span> <span class='kw'>=</span> <span class='fl'>10</span>
<span class='no'>n_condition</span> <span class='kw'>=</span> <span class='fl'>5</span>
<span class='no'>ABC</span> <span class='kw'>=</span>
  <span class='fu'><a href='http://dplyr.tidyverse.org/reference/reexports.html'>data_frame</a></span>(
    <span class='kw'>condition</span> <span class='kw'>=</span> <span class='fu'>rep</span>(<span class='fu'>c</span>(<span class='st'>"A"</span>,<span class='st'>"B"</span>,<span class='st'>"C"</span>,<span class='st'>"D"</span>,<span class='st'>"E"</span>), <span class='no'>n</span>),
    <span class='kw'>response</span> <span class='kw'>=</span> <span class='fu'>rnorm</span>(<span class='no'>n</span> * <span class='fl'>5</span>, <span class='fu'>c</span>(<span class='fl'>0</span>,<span class='fl'>1</span>,<span class='fl'>2</span>,<span class='fl'>1</span>,-<span class='fl'>1</span>), <span class='fl'>0.5</span>)
  )

<span class='co'># We'll fit the following model to it:</span>
<span class='no'>stan_code</span> <span class='kw'>=</span> <span class='st'>"
  data {
    int&lt;lower=1&gt; n;
    int&lt;lower=1&gt; n_condition;
    int&lt;lower=1, upper=n_condition&gt; condition[n];
    real response[n];
  }
  parameters {
    real overall_mean;
    vector[n_condition] condition_zoffset;
    real&lt;lower=0&gt; response_sd;
    real&lt;lower=0&gt; condition_mean_sd;
  }
  transformed parameters {
    vector[n_condition] condition_mean;
    condition_mean = overall_mean + condition_zoffset * condition_mean_sd;
  }
  model {
    response_sd ~ cauchy(0, 1);       // =&gt; half-cauchy(0, 1)
    condition_mean_sd ~ cauchy(0, 1); // =&gt; half-cauchy(0, 1)
    overall_mean ~ normal(0, 5);
    condition_zoffset ~ normal(0, 1); //=&gt; condition_mean ~ normal(overall_mean, condition_mean_sd)
    for (i in 1:n) {
      response[i] ~ normal(condition_mean[condition[i]], response_sd);
    }
  }
  "</span>

<span class='no'>m</span> <span class='kw'>=</span> <span class='fu'><a href='http://www.rdocumentation.org/packages/rstan/topics/stan'>stan</a></span>(<span class='kw'>model_code</span> <span class='kw'>=</span> <span class='no'>stan_code</span>, <span class='kw'>data</span> <span class='kw'>=</span> <span class='fu'><a href='compose_data.html'>compose_data</a></span>(<span class='no'>ABC</span>), <span class='kw'>control</span> <span class='kw'>=</span> <span class='fu'>list</span>(<span class='kw'>adapt_delta</span><span class='kw'>=</span><span class='fl'>0.99</span>),
  <span class='co'># 1 chain / few iterations just so example runs quickly</span>
  <span class='co'># do not use in practice</span>
  <span class='kw'>chains</span> <span class='kw'>=</span> <span class='fl'>1</span>, <span class='kw'>iter</span> <span class='kw'>=</span> <span class='fl'>500</span>)</div><div class='output co'>#&gt; In file included from C:/R/R-3.4.2/library/BH/include/boost/config.hpp:39:0,
#&gt;                  from C:/R/R-3.4.2/library/BH/include/boost/math/tools/config.hpp:13,
#&gt;                  from C:/R/R-3.4.2/library/StanHeaders/include/stan/math/rev/core/var.hpp:7,
#&gt;                  from C:/R/R-3.4.2/library/StanHeaders/include/stan/math/rev/core/gevv_vvv_vari.hpp:5,
#&gt;                  from C:/R/R-3.4.2/library/StanHeaders/include/stan/math/rev/core.hpp:12,
#&gt;                  from C:/R/R-3.4.2/library/StanHeaders/include/stan/math/rev/mat.hpp:4,
#&gt;                  from C:/R/R-3.4.2/library/StanHeaders/include/stan/math.hpp:4,
#&gt;                  from C:/R/R-3.4.2/library/StanHeaders/include/src/stan/model/model_header.hpp:4,
#&gt;                  from filef57466f312b6.cpp:8:
#&gt; C:/R/R-3.4.2/library/BH/include/boost/config/compiler/gcc.hpp:186:0: warning: "BOOST_NO_CXX11_RVALUE_REFERENCES" redefined
#&gt;  #  define BOOST_NO_CXX11_RVALUE_REFERENCES
#&gt;  ^
#&gt; &lt;command-line&gt;:0:0: note: this is the location of the previous definition
#&gt; cc1plus.exe: warning: unrecognized command line option "-Wno-ignored-attributes"
#&gt; 
#&gt; SAMPLING FOR MODEL 'dd2cc433974aea50803799100a5d323d' NOW (CHAIN 1).
#&gt; 
#&gt; Gradient evaluation took 0 seconds
#&gt; 1000 transitions using 10 leapfrog steps per transition would take 0 seconds.
#&gt; Adjust your expectations accordingly!
#&gt; 
#&gt; 
#&gt; Iteration:   1 / 500 [  0%]  (Warmup)
#&gt; Iteration:  50 / 500 [ 10%]  (Warmup)
#&gt; Iteration: 100 / 500 [ 20%]  (Warmup)
#&gt; Iteration: 150 / 500 [ 30%]  (Warmup)
#&gt; Iteration: 200 / 500 [ 40%]  (Warmup)
#&gt; Iteration: 250 / 500 [ 50%]  (Warmup)
#&gt; Iteration: 251 / 500 [ 50%]  (Sampling)
#&gt; Iteration: 300 / 500 [ 60%]  (Sampling)
#&gt; Iteration: 350 / 500 [ 70%]  (Sampling)
#&gt; Iteration: 400 / 500 [ 80%]  (Sampling)
#&gt; Iteration: 450 / 500 [ 90%]  (Sampling)
#&gt; Iteration: 500 / 500 [100%]  (Sampling)
#&gt; 
#&gt;  Elapsed Time: 0.232 seconds (Warm-up)
#&gt;                0.136 seconds (Sampling)
#&gt;                0.368 seconds (Total)
#&gt; </div><div class='input'>
<span class='co'># without using recover_types(), the `condition` column returned by spread_samples()</span>
<span class='co'># will be an integer:</span>
<span class='no'>m</span> <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='spread_samples.html'>spread_samples</a></span>(<span class='no'>condition_mean</span>[<span class='no'>condition</span>]) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='point_interval.html'>mean_qi</a></span>()</div><div class='output co'>#&gt; # A tibble: 5 x 5
#&gt; # Groups: condition [5]
#&gt;   condition condition_mean conf.low conf.high .prob
#&gt;       &lt;int&gt;          &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1         1          0.199   -0.124     0.628 0.950
#&gt; 2         2          0.996    0.653     1.33  0.950
#&gt; 3         3          1.83     1.45      2.21  0.950
#&gt; 4         4          1.03     0.658     1.39  0.950
#&gt; 5         5         -0.883   -1.22     -0.534 0.950</div><div class='input'>
<span class='co'># If we apply recover_types() first, subsequent calls to other tidybayes functions will</span>
<span class='co'># automatically back-convert factors so that they are labeled with their original levels</span>
<span class='co'># (assuming the same name is used)</span>
<span class='no'>m</span> <span class='kw'>%&lt;&gt;%</span> <span class='fu'>recover_types</span>(<span class='no'>ABC</span>)

<span class='co'># now the `condition` column with be a factor with levels "A", "B", "C", ...</span>
<span class='no'>m</span> <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='spread_samples.html'>spread_samples</a></span>(<span class='no'>condition_mean</span>[<span class='no'>condition</span>]) <span class='kw'>%&gt;%</span>
  <span class='fu'><a href='point_interval.html'>mean_qi</a></span>()</div><div class='output co'>#&gt; # A tibble: 5 x 5
#&gt; # Groups: condition [5]
#&gt;   condition condition_mean conf.low conf.high .prob
#&gt;   &lt;fctr&gt;             &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;
#&gt; 1 A                  0.199   -0.124     0.628 0.950
#&gt; 2 B                  0.996    0.653     1.33  0.950
#&gt; 3 C                  1.83     1.45      2.21  0.950
#&gt; 4 D                  1.03     0.658     1.39  0.950
#&gt; 5 E                 -0.883   -1.22     -0.534 0.950</div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>

      <li><a href="#see-also">See also</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

    <h2>Author</h2>
    
Matthew Kay

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://www.mjskay.com'>Matthew Kay</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  </body>
</html>
