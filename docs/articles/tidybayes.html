<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using tidy data with Bayesian models • tidybayes</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/paper/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Using tidy data with Bayesian models">
<meta property="og:description" content="">
<meta property="og:image" content="http://mjskay.github.io/tidybayes/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-93322-5"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-93322-5');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">tidybayes</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/tidybayes.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/tidy-brms.html">Extracting and visualizing tidy draws from brms models</a>
    </li>
    <li>
      <a href="../articles/tidy-rstanarm.html">Extracting and visualizing tidy draws from rstanarm models</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mjskay/tidybayes">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Using tidy data with Bayesian models</h1>
                        <h4 class="author">Matthew Kay</h4>
            
            <h4 class="date">2018-07-31</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mjskay/tidybayes/blob/master/vignettes/tidybayes.Rmd"><code>vignettes/tidybayes.Rmd</code></a></small>
      <div class="hidden name"><code>tidybayes.Rmd</code></div>

    </div>

    
    
<style type="text/css">
.kable-table table {
  margin-left: 0;
}
img {
  border: none;
}
</style>
<div id="introduction" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction" class="anchor"></a>Introduction</h2>
<p>This vignette introduces the <code>tidybayes</code> package, which facilitates the use of tidy data (one observation per row) with Bayesian models in R. This vignette is geared towards working with tidy data in general-purpose modeling functions like JAGS or Stan. For a similar introduction to the use of <code>tidybayes</code> with high-level modeling functions such as those in <code>brms</code> or <code>rstanarm</code>, see <code><a href="tidy-brms.html">vignette(“tidy-brms”)</a></code> or <code><a href="tidy-rstanarm.html">vignette(“tidy-rstanarm”)</a></code>.</p>
<p>The default output (and sometimes input) data formats of popular modeling functions like JAGS and Stan often don’t quite conform to the ideal of <a href="http://dx.doi.org/10.18637/jss.v059.i10">tidy data</a>. For example, input formats might expect a list instead of a data frame, and for all variables to be encoded as numeric values (requiring translation of factors to numeric values and the creation of index variables to store the number of levels per factor or the number of observations in a data frame). Output formats will often be in matrix form (requiring conversion for use with libraries like ggplot), and will use numeric indices (requiring conversion back into factor level names if the you wish to make meaningfully-labeled plots or tables). <code>tidybayes</code> automates all of these sorts of tasks.</p>
<div id="philosophy" class="section level3">
<h3 class="hasAnchor">
<a href="#philosophy" class="anchor"></a>Philosophy</h3>
<p>There are a few core ideas that run through the <code>tidybayes</code> API that should (hopefully) make it easy to use:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Tidy data does not always mean all parameter names as values</strong>. In contrast to the <code>ggmcmc</code> library (which translates model results into a data frame with a <code>Parameter</code> and <code>value</code> column), the <code>spread_draws</code> function in <code>tidybayes</code> produces in data frames where the columns are named after parameters and (in some cases) indices of those parameters, as automatically as possible and using a syntax as close to the same way you would refer to those variables in the model’s language as possible. A similar function to <code>ggmcmc</code>’s approach is also provided in <code>gather_draws</code>, since sometimes you <em>do</em> want variable names as values in a column. The goal is for <code>tidybayes</code> to do the tedious work of figuring out how to make a data frame look the way you need it to, including turning parameters with indices like <code>"b[1,2]"</code> and the like into tidy data for you.</p></li>
<li><p><strong>Fit into the tidyverse</strong>. <code>tidybayes</code> methods fit into a workflow familiar to users of the <code>tidyverse</code> (<code>dplyr</code>, <code>tidyr</code>, <code>ggplot2</code>, etc), which means fitting into the pipe (<code>%&gt;%</code>) workflow, using and respecting grouped data frames (thus <code>spread_draws</code> and <code>gather_draws</code> return results already grouped by variable indices, and methods like <code>median_qi</code> calculate point summaries and intervals for variables and groups simultaneously), and not reinventing too much of the wheel if it is already made easy by functions provided by existing <code>tidyverse</code> packages (unless it makes for much clearer code for a common idiom). For compatibility with other package column names (such as <code><a href="http://www.rdocumentation.org/packages/broom/topics/tidy">broom::tidy</a></code>), <code>tidybayes</code> provides transformation functions like <code>to_broom_names</code> that can be dropped directly into data transformation pipelines.</p></li>
<li><p><strong>Focus on composable operations and plotting primitives, not monolithic plots and operations</strong>. Several other packages (notably <code>bayesplot</code> and <code>ggmcmc</code>) already provide an excellent variety of pre-made methods for plotting Bayesian results. <code>tidybayes</code> shies away from duplicating this functionality. Instead, it focuses on providing composable operations for generating and manipulating Bayesian samples in a tidy data format, and graphical primitives for <code>ggplot</code> that allow you to build custom plots easily. Most simply, where <code>bayesplot</code> and <code>ggmcmc</code> tend to have functions with many options that return a full ggplot object, <code>tidybayes</code> tends towards providing primitives (like <code>geom</code>s) that you can compose and combine into your own custom plots. I believe both approaches have their place: pre-made functions are especially useful for common, quick operations that don’t need customization (like many diagnostic plots), while composable operations tend to be useful for more complex custom plots (in <a href="http://blog.mjskay.com/2017/11/05/i-don-t-want-your-monolithic-ggplot-function/">my opinion</a>).</p></li>
<li><p><strong>Sensible defaults make life easy.</strong> But options (and the data being tidy in the first place) make it easy to go your own way when you need to.</p></li>
<li><p><strong>Variable names in models should be descriptive, not cryptic</strong>. This principle implies avoiding cryptic (and short) subscripts in favor of longer (but descriptive) ones. This is a matter of readability and accessibility of models to others. For example, a common pattern among Stan users (and in the Stan manual) is to use variables like <code>J</code> to refer to the number of elements in a group (e.g., number of participants) and a corresponding index like <code>j</code> to refer to specific elements in that group. I believe this sacrifices too much readability for the sake of concision; I prefer a pattern like <code>n_participant</code> for the size of the group and <code>participant</code> (or a mnemonic short form like <code>p</code>) for specific elements. In functions where names are auto-generated (like <code>compose_data</code>), <code>tidybayes</code> will (by default) assume you want these sorts of more descriptive names; however, you can always override the default naming scheme.</p></li>
</ol>
</div>
<div id="supported-model-types" class="section level3">
<h3 class="hasAnchor">
<a href="#supported-model-types" class="anchor"></a>Supported model types</h3>
<p><code>tidybayes</code> aims to support a variety of models with a uniform interface. Currently supported models include <a href="https://cran.r-project.org/package=rstan">rstan</a>, <a href="https://cran.r-project.org/package=brms">brms</a>, <a href="https://cran.r-project.org/package=rstanarm">rstanarm</a>, <a href="https://cran.r-project.org/package=runjags">runjags</a>, <a href="https://cran.r-project.org/package=rjags">rjags</a>, <a href="https://cran.r-project.org/package=jagsUI">jagsUI</a>, <a href="https://cran.r-project.org/package=coda">coda::mcmc and coda::mcmc.list</a>, <a href="https://cran.r-project.org/package=MCMCglmm">MCMCglmm</a>, and anything with its own <code>as.mcmc.list</code> implementation. If you install the <a href="https://github.com/mjskay/tidybayes.rethinking">tidybayes.rethinking</a> package, models from the <a href="https://github.com/rmcelreath/rethinking">rethinking</a> package are also supported.</p>
<p>For an up-to-date list of supported models, see <code><a href="../reference/tidybayes-models.html">?"tidybayes-models"</a></code>.</p>
</div>
</div>
<div id="setup" class="section level2">
<h2 class="hasAnchor">
<a href="#setup" class="anchor"></a>Setup</h2>
<p>The following libraries are required to run this vignette:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(magrittr)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="kw">library</span>(forcats)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="kw">library</span>(ggplot2)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw">library</span>(ggstance)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">library</span>(emmeans)</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="kw">library</span>(broom)</a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="kw">library</span>(rstan)</a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw">library</span>(rstanarm)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="kw">library</span>(brms)</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="kw">library</span>(modelr)</a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="kw">library</span>(bayesplot)</a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="kw">library</span>(tidybayes)</a></code></pre></div>
<p>These options help Stan run faster:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">rstan_options</span>(<span class="dt">auto_write =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="kw">options</span>(<span class="dt">mc.cores =</span> parallel<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/parallel/topics/detectCores">detectCores</a></span>())</a></code></pre></div>
</div>
<div id="example-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#example-dataset" class="anchor"></a>Example dataset</h2>
<p>To demonstrate <code>tidybayes</code>, we will use a simple dataset with 10 observations from 5 conditions each:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">5</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">n =<span class="st"> </span><span class="dv">10</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3">n_condition =<span class="st"> </span><span class="dv">5</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">ABC =</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="st">  </span><span class="kw">data_frame</span>(</a>
<a class="sourceLine" id="cb3-6" data-line-number="6">    <span class="dt">condition =</span> <span class="kw">rep</span>(<span class="kw">c</span>(<span class="st">"A"</span>,<span class="st">"B"</span>,<span class="st">"C"</span>,<span class="st">"D"</span>,<span class="st">"E"</span>), n),</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">    <span class="dt">response =</span> <span class="kw">rnorm</span>(n <span class="op">*</span><span class="st"> </span><span class="dv">5</span>, <span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="op">-</span><span class="dv">1</span>), <span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb3-8" data-line-number="8">  )</a></code></pre></div>
<p>A snapshot of the data looks like this:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">head</span>(ABC, <span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 2
##    condition response
##    &lt;chr&gt;        &lt;dbl&gt;
##  1 A           -0.420
##  2 B            1.69 
##  3 C            1.37 
##  4 D            1.04 
##  5 E           -0.144
##  6 A           -0.301
##  7 B            0.764
##  8 C            1.68 
##  9 D            0.857
## 10 E           -0.931</code></pre>
<p><em>(10 rows of 50)</em></p>
<p>This is a typical tidy format data frame: one observation per row. Graphically:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">ABC <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> response, <span class="dt">y =</span> <span class="kw">fct_rev</span>(condition))) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.5</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4"><span class="st">  </span><span class="kw">ylab</span>(<span class="st">"condition"</span>)</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-4-1.png" width="576"></p>
</div>
<div id="using-compose_data-to-prepare-a-data-frame-for-the-model" class="section level2">
<h2 class="hasAnchor">
<a href="#using-compose_data-to-prepare-a-data-frame-for-the-model" class="anchor"></a>Using <code>compose_data</code> to prepare a data frame for the model</h2>
<p>Shunting data from a data frame into a format usable in samplers like JAGS or Stan can involve a tedious set of operations, like generating index variables storing the number of operations or the number of levels in a factor. <code>compose_data</code> automates these operations.</p>
<p>A hierarchical model of our example data might fit an overall mean across the conditions (<code>overall_mean</code>), the standard deviation of the condition means (<code>condition_mean_sd</code>), the mean within each condition (<code>condition_mean[condition]</code>) and the standard deviation of the responses given a condition mean (<code>response_sd</code>):</p>
<pre class="stan"><code>data {
  int&lt;lower=1&gt; n;
  int&lt;lower=1&gt; n_condition;
  int&lt;lower=1, upper=n_condition&gt; condition[n];
  real response[n];
}
parameters {
  real overall_mean;
  vector[n_condition] condition_zoffset;
  real&lt;lower=0&gt; response_sd;
  real&lt;lower=0&gt; condition_mean_sd;
}
transformed parameters {
  vector[n_condition] condition_mean;
  condition_mean = overall_mean + condition_zoffset * condition_mean_sd;
}
model {
  response_sd ~ cauchy(0, 1);         // =&gt; half-cauchy(0, 1)
  condition_mean_sd ~ cauchy(0, 1);   // =&gt; half-cauchy(0, 1)
  overall_mean ~ normal(0, 5);
  condition_zoffset ~ normal(0, 1);   // =&gt; condition_mean ~ normal(overall_mean, condition_mean_sd)
  for (i in 1:n) {
    response[i] ~ normal(condition_mean[condition[i]], response_sd);
  }
}</code></pre>
<p>We have compiled and loaded this model into the variable <code>ABC_stan</code>.</p>
<p>This model expects these variables as input:</p>
<ul>
<li>
<code>n</code>: number of observations</li>
<li>
<code>n_condition</code>: number of conditions</li>
<li>
<code>condition</code>: a vector of integers indicating the condition of each observation</li>
<li>
<code>response</code>: a vector of observations</li>
</ul>
<p>Our data frame (<code>ABC</code>) only has <code>response</code> and <code>condition</code>, and <code>condition</code> is in the wrong format (it is a factor instead of numeric). However, <code>compose_data</code> can generate a list containing the above variables in the correct format automatically. It recognizes that <code>condition</code> is a factor and converts it to a numeric, adds the <code>n_condition</code> variable automatically containing the number of levels in <code>condition</code>, and adds the <code>n</code> column containing the number of observations (number of rows in the data frame):</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw"><a href="../reference/compose_data.html">compose_data</a></span>(ABC)</a></code></pre></div>
<pre><code>## $condition
##  [1] 1 2 3 4 5 1 2 3 4 5 1 2 3 4 5 1 2 3 4 5 1 2 3 4 5 1 2 3 4 5 1 2 3 4 5 1 2 3 4 5 1 2 3 4 5 1 2 3
## [49] 4 5
## 
## $n_condition
## [1] 5
## 
## $response
##  [1] -0.42042774  1.69217967  1.37225407  1.03507138 -0.14427956 -0.30145399  0.76391681  1.68231434
##  [9]  0.85711318 -0.93094589  0.61381517  0.59911027  1.45980370  0.92123282 -1.53588002 -0.06949307
## [17]  0.70134345  0.90801662  1.12040863 -1.12967770  0.45025597  1.47093470  2.73398095  1.35338054
## [25] -0.59049553 -0.14674092  1.70929454  2.74938691  0.67145895 -1.42639772  0.15795752  1.55484708
## [33]  3.10773029  1.60855182 -0.26038911  0.47578692  0.49523368  0.99976363  0.11890706 -1.07130406
## [41]  0.77503018  0.59878841  1.96271054  1.94783398 -1.22828447  0.28111168  0.55649574  1.76987771
## [49]  0.63783576 -1.03460558
## 
## $n
## [1] 50</code></pre>
<p>This makes it easy to skip right to running the model without munging the data yourself:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">m =<span class="st"> </span><span class="kw">sampling</span>(ABC_stan, <span class="dt">data =</span> <span class="kw"><a href="../reference/compose_data.html">compose_data</a></span>(ABC), <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">adapt_delta=</span><span class="fl">0.99</span>))</a></code></pre></div>
<p>The results look like this:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1"><span class="kw">print</span>(m, <span class="dt">pars =</span> <span class="kw">c</span>(<span class="st">"overall_mean"</span>, <span class="st">"condition_mean_sd"</span>, <span class="st">"condition_mean"</span>, <span class="st">"response_sd"</span>))</a></code></pre></div>
<pre><code>## Inference for Stan model: a079ffbff39f9d3c47919d14be5398a6.
## 4 chains, each with iter=2000; warmup=1000; thin=1; 
## post-warmup draws per chain=1000, total post-warmup draws=4000.
## 
##                    mean se_mean   sd  2.5%   25%   50%   75% 97.5% n_eff Rhat
## overall_mean       0.59    0.02 0.57 -0.59  0.26  0.59  0.93  1.69   825    1
## condition_mean_sd  1.22    0.02 0.56  0.61  0.87  1.09  1.43  2.49  1021    1
## condition_mean[1]  0.19    0.00 0.17 -0.14  0.08  0.19  0.31  0.55  4000    1
## condition_mean[2]  1.01    0.00 0.17  0.66  0.89  1.00  1.12  1.35  4000    1
## condition_mean[3]  1.84    0.00 0.18  1.49  1.72  1.84  1.96  2.18  4000    1
## condition_mean[4]  1.01    0.00 0.18  0.65  0.89  1.01  1.13  1.37  4000    1
## condition_mean[5] -0.89    0.00 0.18 -1.24 -1.02 -0.89 -0.77 -0.54  4000    1
## response_sd        0.56    0.00 0.06  0.45  0.52  0.56  0.60  0.70  1698    1
## 
## Samples were drawn using NUTS(diag_e) at Tue Jul 31 19:40:14 2018.
## For each parameter, n_eff is a crude measure of effective sample size,
## and Rhat is the potential scale reduction factor on split chains (at 
## convergence, Rhat=1).</code></pre>
</div>
<div id="extracting-draws-from-a-fit-in-tidy-format-using-spread_draws" class="section level2">
<h2 class="hasAnchor">
<a href="#extracting-draws-from-a-fit-in-tidy-format-using-spread_draws" class="anchor"></a>Extracting draws from a fit in tidy-format using <code>spread_draws</code>
</h2>
<div id="extracting-model-variable-indices-into-a-separate-column-in-a-tidy-format-data-frame" class="section level3">
<h3 class="hasAnchor">
<a href="#extracting-model-variable-indices-into-a-separate-column-in-a-tidy-format-data-frame" class="anchor"></a>Extracting model variable indices into a separate column in a tidy format data frame</h3>
<p>Now that we have our results, the fun begins: getting the draws out in a tidy format! The default methods in Stan for extracting draws from the model do so in a nested format:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1"><span class="kw">str</span>(rstan<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/rstan/topics/stanfit-method-extract">extract</a></span>(m))</a></code></pre></div>
<pre><code>## List of 6
##  $ overall_mean     : num [1:4000(1d)] 1.422 1.508 0.984 0.14 1.402 ...
##   ..- attr(*, "dimnames")=List of 1
##   .. ..$ iterations: NULL
##  $ condition_zoffset: num [1:4000, 1:5] -1.7742 -0.5655 -0.4899 0.0689 -0.4516 ...
##   ..- attr(*, "dimnames")=List of 2
##   .. ..$ iterations: NULL
##   .. ..$           : NULL
##  $ response_sd      : num [1:4000(1d)] 0.474 0.541 0.53 0.549 0.627 ...
##   ..- attr(*, "dimnames")=List of 1
##   .. ..$ iterations: NULL
##  $ condition_mean_sd: num [1:4000(1d)] 0.797 2.123 1.838 1.234 1.982 ...
##   ..- attr(*, "dimnames")=List of 1
##   .. ..$ iterations: NULL
##  $ condition_mean   : num [1:4000, 1:5] 0.00793 0.30764 0.08418 0.22466 0.50649 ...
##   ..- attr(*, "dimnames")=List of 2
##   .. ..$ iterations: NULL
##   .. ..$           : NULL
##  $ lp__             : num [1:4000(1d)] -2.83 -1.32 4.15 2.64 1.59 ...
##   ..- attr(*, "dimnames")=List of 1
##   .. ..$ iterations: NULL</code></pre>
<p>There are also methods for extracting draws as matrices or data frames in Stan (and other model types, such as JAGS and MCMCglmm, have their own formats).</p>
<p>The <code>spread_draws</code> method yields a common format for all model types supported by <code>tidybayes</code>. It lets us instead extract draws into a data frame in tidy format, with a <code>.chain</code> and <code>.iteration</code> column storing the chain and iteration for each row (if available), a <code>.draw</code> column that uniquely indexes each draw, and the remaining columns corresponding to model variables or variable indices. The <code>spread_draws</code> method accepts any number of column specifications, which can include names for variables and names for variable indices. For example, we can extract the <code>condition_mean</code> variable as a tidy data frame, and put the value of its first (and only) index into the <code>condition</code> column, using a syntax that directly echoes how we would specify indices of the <code>condition_mean</code> variable in the model itself:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb15-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 5
## # Groups:   condition [5]
##    .chain .iteration .draw condition condition_mean
##     &lt;int&gt;      &lt;int&gt; &lt;int&gt;     &lt;int&gt;          &lt;dbl&gt;
##  1      1          1     1         1        -0.0488
##  2      1          1     1         2         1.19  
##  3      1          1     1         3         1.90  
##  4      1          1     1         4         0.962 
##  5      1          1     1         5        -0.878 
##  6      1          2     2         1         0.193 
##  7      1          2     2         2         1.07  
##  8      1          2     2         3         1.97  
##  9      1          2     2         4         1.12  
## 10      1          2     2         5        -1.09</code></pre>
<p><em>(10 rows of 50)</em></p>
</div>
<div id="automatically-converting-columns-and-indices-back-into-their-original-data-types" class="section level3">
<h3 class="hasAnchor">
<a href="#automatically-converting-columns-and-indices-back-into-their-original-data-types" class="anchor"></a>Automatically converting columns and indices back into their original data types</h3>
<p>As-is, the resulting variables don’t know anything about where their indices came from. The index of the <code>condition_mean</code> variable was originally derived from the <code>condition</code> factor in the <code>ABC</code> data frame. But Stan doesn’t know this: it is just a numeric index to Stan, so the <code>condition</code> column just contains numbers (<code>1, 2, 3, 4, 5</code>) instead of the factor levels these numbers correspond to (<code>"A", "B", "C", "D", "E"</code>).</p>
<p>We can recover this missing type information by passing the model through <code>recover_types</code> before using <code>spread_draws</code>. In itself <code>recover_types</code> just returns a copy of the model, with some additional attributes that store the type information from the data frame (or other objects) that you pass to it. This doesn’t have any useful effect by itself, but functions like <code>spread_draws</code> use this information to convert any column or index back into the data type of the column with the same name in the original data frame. In this example, <code>spread_draws</code> recognizes that the <code>condition</code> column was a factor with five levels (<code>"A", "B", "C", "D", "E"</code>) in the original data frame, and automatically converts it back into a factor:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/recover_types.html">recover_types</a></span>(ABC) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb17-4" data-line-number="4"><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 5
## # Groups:   condition [5]
##    .chain .iteration .draw condition condition_mean
##     &lt;int&gt;      &lt;int&gt; &lt;int&gt; &lt;fct&gt;              &lt;dbl&gt;
##  1      1          1     1 A                -0.0488
##  2      1          1     1 B                 1.19  
##  3      1          1     1 C                 1.90  
##  4      1          1     1 D                 0.962 
##  5      1          1     1 E                -0.878 
##  6      1          2     2 A                 0.193 
##  7      1          2     2 B                 1.07  
##  8      1          2     2 C                 1.97  
##  9      1          2     2 D                 1.12  
## 10      1          2     2 E                -1.09</code></pre>
<p><em>(10 rows of 20000)</em></p>
<p>Because we often want to make multiple separate calls to <code>spread_draws</code>, it is often convenient to decorate the original model using <code>recover_types</code> immediately after it has been fit, so we only have to call it once:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" data-line-number="1">m <span class="op">%&lt;&gt;%</span><span class="st"> </span><span class="kw"><a href="../reference/recover_types.html">recover_types</a></span>(ABC)</a></code></pre></div>
<p>Now we can omit the <code>recover_types</code> call before subsequent calls to <code>spread_draws</code>.</p>
</div>
</div>
<div id="point-summaries-and-intervals-with-the-point_interval-functions-medianmeanmode_qihdi" class="section level2">
<h2 class="hasAnchor">
<a href="#point-summaries-and-intervals-with-the-point_interval-functions-medianmeanmode_qihdi" class="anchor"></a>Point summaries and intervals with the <code>point_interval</code> functions: <code>[median|mean|mode]_[qi|hdi]</code>
</h2>
<div id="with-simple-variables-wide-format" class="section level3">
<h3 class="hasAnchor">
<a href="#with-simple-variables-wide-format" class="anchor"></a>With simple variables, wide format</h3>
<p><code>tidybayes</code> provides a family of functions for generating point summaries and intervals from draws in a tidy format. These functions follow the naming scheme <code>[median|mean|mode]_[qi|hdi]</code>, for example, <code>median_qi</code>, <code>mean_qi</code>, <code>mode_hdi</code>, and so on. The first name (before the <code>_</code>) indicates the type of point summary, and the second name indicates the type of interval. <code>qi</code> yields a quantile interval (a.k.a. equi-tailed interval, central interval, or percentile interval) and <code>hdi</code> yields a highest density interval. Custom point or interval functions can also be applied using the <code>point_interval</code> function.</p>
<p>For example, we might extract the draws corresponding to the overall mean and standard deviation of observations:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(overall_mean, response_sd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb20-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 5
##    .chain .iteration .draw overall_mean response_sd
##     &lt;int&gt;      &lt;int&gt; &lt;int&gt;        &lt;dbl&gt;       &lt;dbl&gt;
##  1      1          1     1        0.810       0.582
##  2      1          2     2        0.762       0.596
##  3      1          3     3        0.689       0.556
##  4      1          4     4        0.845       0.581
##  5      1          5     5        0.626       0.617
##  6      1          6     6        0.431       0.535
##  7      1          7     7        0.475       0.556
##  8      1          8     8        0.542       0.489
##  9      1          9     9        1.24        0.608
## 10      1         10    10        1.14        0.630</code></pre>
<p><em>(10 rows of 4000)</em></p>
<p>Like with <code>condition_mean[condition]</code>, this gives us a tidy data frame. If we want the median and 95% quantile interval of the variables, we can apply <code>median_qi</code>:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(overall_mean, response_sd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb22-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>(overall_mean, response_sd)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 9
##   overall_mean overall_mean.lo~ overall_mean.up~ response_sd response_sd.low~ response_sd.upp~
##          &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1        0.586           -0.587             1.69       0.556            0.453            0.700
## # ... with 3 more variables: .width &lt;dbl&gt;, .point &lt;chr&gt;, .interval &lt;chr&gt;</code></pre>
<p><code>median_qi</code> summarizes each input column using its median. If there are multiple columns to summarize, each gets its own <code>x.lower</code> and <code>x.upper</code> column (for each column <code>x</code>) corresponding to the bounds of the <code>.width</code>% interval. If there is only one column, the names <code>.lower</code> and <code>.upper</code> are used for the interval bounds.</p>
<p>We can specify the columns we want to get medians and intervals from, as above, or if we omit the list of columns, <code>median_qi</code> will use every column that is not a grouping column or a special column (like <code>.chain</code>, <code>.iteration</code>, or <code>.draw</code>). Thus in the above example, <code>overall_mean</code> and <code>response_sd</code> are redundant arguments to <code>median_qi</code> because they are also the only columns we gathered from the model. So we can simplify the previous code to the following:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(overall_mean, response_sd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb24-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>()</a></code></pre></div>
<pre><code>## # A tibble: 1 x 9
##   overall_mean overall_mean.lo~ overall_mean.up~ response_sd response_sd.low~ response_sd.upp~
##          &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;       &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
## 1        0.586           -0.587             1.69       0.556            0.453            0.700
## # ... with 3 more variables: .width &lt;dbl&gt;, .point &lt;chr&gt;, .interval &lt;chr&gt;</code></pre>
</div>
<div id="with-indexed-variables" class="section level3">
<h3 class="hasAnchor">
<a href="#with-indexed-variables" class="anchor"></a>With indexed variables</h3>
<p>When we have a variable with one or more indices, such as <code>condition_mean</code>, we can apply <code>median_qi</code> (or other functions in the <code>point_interval</code> family) as we did before:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb26-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>()</a></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   condition condition_mean .lower .upper .width .point .interval
##   &lt;fct&gt;              &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 A                  0.191 -0.137  0.548   0.95 median qi       
## 2 B                  1.00   0.656  1.35    0.95 median qi       
## 3 C                  1.84   1.49   2.18    0.95 median qi       
## 4 D                  1.01   0.654  1.37    0.95 median qi       
## 5 E                 -0.894 -1.24  -0.544   0.95 median qi</code></pre>
<p>How did <code>median_qi</code> know what to aggregate? Data frames returned by <code>spread_draws</code> are automatically grouped by all index variables you pass to it; in this case, that means it groups by <code>condition</code>. <code>median_qi</code> respects groups, and calculates the point summaries and intervals within all groups. Then, because no columns were passed to <code>median_qi</code>, it acts on the only non-special (<code>.</code>-prefixed) and non-group column, <code>condition_mean</code>. So the above shortened syntax is equivalent to this more verbose call:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb28-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb28-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb28-3" data-line-number="3"><span class="st">  </span><span class="kw">group_by</span>(condition) <span class="op">%&gt;%</span><span class="st">    </span><span class="co"># this line not necessary (done automatically by spread_draws)</span></a>
<a class="sourceLine" id="cb28-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>(condition_mean)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   condition condition_mean .lower .upper .width .point .interval
##   &lt;fct&gt;              &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 A                  0.191 -0.137  0.548   0.95 median qi       
## 2 B                  1.00   0.656  1.35    0.95 median qi       
## 3 C                  1.84   1.49   2.18    0.95 median qi       
## 4 D                  1.01   0.654  1.37    0.95 median qi       
## 5 E                 -0.894 -1.24  -0.544   0.95 median qi</code></pre>
<p>When given only a single column, <code>median_qi</code> will use the names <code>.lower</code> and <code>.upper</code> for the lower and upper ends of the intervals.</p>
</div>
</div>
<div id="plotting-points-and-intervals" class="section level2">
<h2 class="hasAnchor">
<a href="#plotting-points-and-intervals" class="anchor"></a>Plotting points and intervals</h2>
<div id="using-geom_pointintervalgeom_pointintervalh" class="section level3">
<h3 class="hasAnchor">
<a href="#using-geom_pointintervalgeom_pointintervalh" class="anchor"></a>Using <code>geom_pointinterval</code>/<code>geom_pointintervalh</code>
</h3>
<p>Plotting medians and intervals is straightforward using the <code>pointinterval</code> geom (or its horizontal version, <code>pointintervalh</code>), which are a modified versions of <code><a href="http://www.rdocumentation.org/packages/ggplot2/topics/geom_linerange">ggplot2::geom_pointrange</a></code> and <code><a href="http://www.rdocumentation.org/packages/ggstance/topics/geom_linerangeh">ggstance::geom_pointrangeh</a></code> with sensible defaults for multiple intervals (functionality we will use later):</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb30-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb30-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb30-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb30-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fct_rev</span>(condition), <span class="dt">x =</span> condition_mean, <span class="dt">xmin =</span> .lower, <span class="dt">xmax =</span> .upper)) <span class="op">+</span></a>
<a class="sourceLine" id="cb30-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/geom_pointinterval.html">geom_pointintervalh</a></span>()</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-18-1.png" width="576"></p>
<p><code>geom_pointintervalh</code> includes <code>xmin = .lower</code> and <code>xmax = .upper</code> in its default aesthetics, so these can be omitted:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb31-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb31-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fct_rev</span>(condition), <span class="dt">x =</span> condition_mean)) <span class="op">+</span></a>
<a class="sourceLine" id="cb31-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/geom_pointinterval.html">geom_pointintervalh</a></span>()</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-19-1.png" width="576"></p>
</div>
<div id="using-stat_pointintervalstat_pointintervalh" class="section level3">
<h3 class="hasAnchor">
<a href="#using-stat_pointintervalstat_pointintervalh" class="anchor"></a>Using <code>stat_pointinterval</code>/<code>stat_pointintervalh</code>
</h3>
<p>Rather than summarizing the posterior before calling ggplot, we could also use <code>stat_pointinterval</code> / <code>stat_pointintervalh</code> to perform the summary within ggplot:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb32-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb32-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb32-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fct_rev</span>(condition), <span class="dt">x =</span> condition_mean)) <span class="op">+</span></a>
<a class="sourceLine" id="cb32-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/stat_pointinterval.html">stat_pointintervalh</a></span>()</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-20-1.png" width="576"></p>
<p>These functions have <code>.width = c(.66, .95)</code> by default (showing 66% and 95% intervals), but this can be changed by passing a <code>.width</code> argument to <code>stat_pointinterval</code> / <code>stat_pointintervalh</code>.</p>
<div id="a-note-on-functions-ending-in-h" class="section level4">
<h4 class="hasAnchor">
<a href="#a-note-on-functions-ending-in-h" class="anchor"></a>A note on functions ending in <code>h</code>
</h4>
<p><code>tidybayes</code> follows the naming convention established by <code>ggstance</code> for horizontal versions of <code>geom</code>s and summary functions. It includes horizontal versions of all <code>point_interval</code> functions, which differ only in their behavior when passed a vector instead of a data frame. These functions have the same name as their vertical counterparts, but end with <code>h</code>.</p>
<p>When using <code>point_interval</code> family functions with geoms and stats defined by packages <em>other than of <code>tidybayes</code></em>, you may need to use the horizontal versions of the <code>point_interval</code> functions, like <code>median_qih</code> (e.g. in the <code>fun.data</code> argument of <code><a href="http://www.rdocumentation.org/packages/ggstance/topics/stat_summaryh">ggstance::stat_summaryh</a></code>). This is because <code>median_qi</code> returns a data frame with <code>y</code>, <code>ymin</code>, and <code>ymax</code> columns when passed a vector (making it suitable for <code><a href="http://www.rdocumentation.org/packages/ggplot2/topics/stat_summary">ggplot2::stat_summary</a></code>), and <code>median_qih</code> returns a data frame with <code>x</code>, <code>xmin</code>, and <code>xmax</code> columns when passed a vector (making it suitable for <code><a href="http://www.rdocumentation.org/packages/ggstance/topics/stat_summaryh">ggstance::stat_summaryh</a></code>). <strong>You do not need to use these functions with tidybayes stats and geoms</strong>; the <code>point_interval</code> argument to tidybayes stats and geoms (like <code>stat_pointinterval</code> and <code>stat_pointintervalh</code>) will automatically convert output of summary functions to the correct aesthetics.</p>
</div>
</div>
<div id="intervals-with-posterior-violins-eye-plots-geom_eye-and-geom_eyeh" class="section level3">
<h3 class="hasAnchor">
<a href="#intervals-with-posterior-violins-eye-plots-geom_eye-and-geom_eyeh" class="anchor"></a>Intervals with posterior violins (“eye plots”): <code>geom_eye</code> and <code>geom_eyeh</code>
</h3>
<p>The <code>stat_summary</code> approach to generating intervals makes it easy to add violin plots of posterior densities to the plot using <code>geom_violin</code>/<code>geom_violinh</code>, forming “eye plots”:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb33-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb33-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb33-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fct_rev</span>(condition), <span class="dt">x =</span> condition_mean)) <span class="op">+</span></a>
<a class="sourceLine" id="cb33-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_violinh</span>(<span class="dt">color =</span> <span class="ot">NA</span>, <span class="dt">fill =</span> <span class="st">"gray65"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb33-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/stat_pointinterval.html">stat_pointintervalh</a></span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.66</span>))</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-21-1.png" width="576"></p>
<p>The <code>geom_eye</code> and <code>geom_eyeh</code> geoms provide a shortcut to generating eye plots with some sensible defaults:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb34-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb34-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb34-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fct_rev</span>(condition), <span class="dt">x =</span> condition_mean)) <span class="op">+</span></a>
<a class="sourceLine" id="cb34-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/geom_eye.html">geom_eyeh</a></span>()</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-22-1.png" width="576"></p>
</div>
<div id="intervals-with-posterior-densities-half-eye-plots-geom_halfeyeh" class="section level3">
<h3 class="hasAnchor">
<a href="#intervals-with-posterior-densities-half-eye-plots-geom_halfeyeh" class="anchor"></a>Intervals with posterior densities (“half-eye plots”): <code>geom_halfeyeh</code>
</h3>
<p>If you prefer densities over violins, you can use <code>geom_halfeyeh</code> (the vertical version, not yet available, will be called <code>geom_halfeye</code>). This example also demonstrates how to change the interval probability (here, to 99% and 80% intervals):</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb35-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb35-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb35-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fct_rev</span>(condition), <span class="dt">x =</span> condition_mean)) <span class="op">+</span></a>
<a class="sourceLine" id="cb35-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/geom_halfeyeh.html">geom_halfeyeh</a></span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">99</span>, <span class="fl">.8</span>))</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-23-1.png" width="576"></p>
</div>
<div id="intervals-with-multiple-probability-levels-the--width-argument" class="section level3">
<h3 class="hasAnchor">
<a href="#intervals-with-multiple-probability-levels-the--width-argument" class="anchor"></a>Intervals with multiple probability levels: the <code>.width =</code> argument</h3>
<p><code>median_qi</code> and its sister functions can also produce an arbitrary number of probability intervals by setting the <code>.width =</code> argument:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb36-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb36-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.8</span>, <span class="fl">.5</span>))</a></code></pre></div>
<pre><code>## # A tibble: 15 x 7
##    condition condition_mean  .lower .upper .width .point .interval
##    &lt;fct&gt;              &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
##  1 A                  0.191 -0.137   0.548   0.95 median qi       
##  2 B                  1.00   0.656   1.35    0.95 median qi       
##  3 C                  1.84   1.49    2.18    0.95 median qi       
##  4 D                  1.01   0.654   1.37    0.95 median qi       
##  5 E                 -0.894 -1.24   -0.544   0.95 median qi       
##  6 A                  0.191 -0.0238  0.411   0.8  median qi       
##  7 B                  1.00   0.784   1.23    0.8  median qi       
##  8 C                  1.84   1.61    2.06    0.8  median qi       
##  9 D                  1.01   0.787   1.24    0.8  median qi       
## 10 E                 -0.894 -1.12   -0.665   0.8  median qi       
## 11 A                  0.191  0.0751  0.307   0.5  median qi       
## 12 B                  1.00   0.890   1.12    0.5  median qi       
## 13 C                  1.84   1.72    1.96    0.5  median qi       
## 14 D                  1.01   0.893   1.13    0.5  median qi       
## 15 E                 -0.894 -1.02   -0.769   0.5  median qi</code></pre>
<p>The results are in a tidy format: one row per index (<code>condition</code>) and probability level (<code>.width</code>). This facilitates plotting. For example, assigning <code>-.width</code> to the <code>size</code> aesthetic will show all intervals, making thicker lines correspond to smaller intervals:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb38-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.66</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb38-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fct_rev</span>(condition), <span class="dt">x =</span> condition_mean, </a>
<a class="sourceLine" id="cb38-5" data-line-number="5">    <span class="dt">size =</span> <span class="op">-</span>.width)) <span class="op">+</span><span class="st">               </span><span class="co"># smaller probability interval =&gt; thicker line</span></a>
<a class="sourceLine" id="cb38-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/geom_pointinterval.html">geom_pointintervalh</a></span>()</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-25-1.png" width="576"></p>
<p>Just as <code>geom_pointintervalh</code> includes <code>xmin = .lower</code> and <code>xmax = .upper</code> as default aesthetics, it also includes <code>size = -.width</code> to facilitate exactly this usage. This, the above can be simplified to:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb39-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb39-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb39-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.66</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb39-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fct_rev</span>(condition), <span class="dt">x =</span> condition_mean)) <span class="op">+</span></a>
<a class="sourceLine" id="cb39-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/geom_pointinterval.html">geom_pointintervalh</a></span>()</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-26-1.png" width="576"></p>
<p>Just as the <code>point_interval</code> functions can generate an arbitrary number of intervals per distribution, so too can <code>geom_pointrangeh</code> draw an arbitrary number of intervals, though in most cases this starts to get pretty silly (and will require the use of <code>size_range =</code>, which determines the minimum and maximum line thickness, to make it legible). Here it is with 3:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb40-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb40-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb40-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>(<span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.8</span>, <span class="fl">.5</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb40-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fct_rev</span>(condition), <span class="dt">x =</span> condition_mean)) <span class="op">+</span></a>
<a class="sourceLine" id="cb40-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/geom_pointinterval.html">geom_pointintervalh</a></span>(<span class="dt">size_range =</span> <span class="kw">c</span>(<span class="fl">0.5</span>, <span class="dv">2</span>))</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-27-1.png" width="576"></p>
</div>
<div id="plotting-posteriors-as-quantile-dotplots" class="section level3">
<h3 class="hasAnchor">
<a href="#plotting-posteriors-as-quantile-dotplots" class="anchor"></a>Plotting posteriors as quantile dotplots</h3>
<p>Intervals are nice if the alpha level happens to line up with whatever decision you are trying to make, but getting a shape of the posterior is better (hence eye plots, above). On the other hand, making inferences from density plots is imprecise (estimating the area of one shape as a proportion of another is a hard perceptual task). Reasoning about probability in frequency formats is easier, motivating <a href="https://github.com/mjskay/when-ish-is-my-bus/blob/master/quantile-dotplots.html">quantile dotplots</a>, which also allow precise estimation of arbitrary intervals (down to the dot resolution of the plot, here 100):</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb41-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb41-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb41-3" data-line-number="3"><span class="st">  </span><span class="kw">do</span>(<span class="kw">data_frame</span>(<span class="dt">condition_mean =</span> <span class="kw">quantile</span>(.<span class="op">$</span>condition_mean, <span class="kw">ppoints</span>(<span class="dv">100</span>)))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb41-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> condition_mean)) <span class="op">+</span></a>
<a class="sourceLine" id="cb41-5" data-line-number="5"><span class="st">  </span><span class="kw">geom_dotplot</span>(<span class="dt">binwidth =</span> <span class="fl">.04</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb41-6" data-line-number="6"><span class="st">  </span><span class="kw">facet_grid</span>(<span class="kw">fct_rev</span>(condition) <span class="op">~</span><span class="st"> </span>.) <span class="op">+</span></a>
<a class="sourceLine" id="cb41-7" data-line-number="7"><span class="st">  </span><span class="kw">scale_y_continuous</span>(<span class="dt">breaks =</span> <span class="ot">NULL</span>)</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-28-1.png" width="576"></p>
<p>The idea is to get away from thinking about the posterior as indicating one canonical point or interval, but instead to represent it as (say) 100 approximately equally likely points.</p>
</div>
<div id="alternative-point-summaries-and-intervals-median-mean-mode-qi-hdi-hdci" class="section level3">
<h3 class="hasAnchor">
<a href="#alternative-point-summaries-and-intervals-median-mean-mode-qi-hdi-hdci" class="anchor"></a>Alternative point summaries and intervals: median, mean, mode; qi, hdi, hdci</h3>
<p>The <code>point_interval</code> family of functions follow the naming scheme <code>[median|mean|mode]_[qi|hdi|hdci][h|]</code>, and all work in the same way as <code>median_qi</code>: they take a series of names (or expressions calculated on columns) and summarize those columns with the corresponding point summary function (median, mean, or mode) and interval (qi, hdi, or hdci). <code>qi</code> yields a quantile interval (a.k.a. equi-tailed interval, central interval, or percentile interval), <code>hdi</code> yields one or more highest (posterior) density interval(s), and <code>hdci</code> yields a single (possibly) highest-density continuous interval. These can be used in any combination desired.</p>
<p>The <code>*_hdi</code> functions have an additional difference: In the case of multimodal distributions, they may return multiple intervals for each probability level. Here are some draws from a multimodal normal mixture:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb42-1" data-line-number="1"><span class="kw">set.seed</span>(<span class="dv">123</span>)</a>
<a class="sourceLine" id="cb42-2" data-line-number="2">multimodal_draws =<span class="st"> </span><span class="kw">data_frame</span>(</a>
<a class="sourceLine" id="cb42-3" data-line-number="3">  <span class="dt">x =</span> <span class="kw">c</span>(<span class="kw">rnorm</span>(<span class="dv">5000</span>, <span class="dv">0</span>, <span class="dv">1</span>), <span class="kw">rnorm</span>(<span class="dv">2500</span>, <span class="dv">4</span>, <span class="dv">1</span>))</a>
<a class="sourceLine" id="cb42-4" data-line-number="4">)</a></code></pre></div>
<p>Passed through <code>mode_hdi</code>, we get multiple intervals at the 80% probability level:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb43-1" data-line-number="1">multimodal_draws <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb43-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">mode_hdi</a></span>(x, <span class="dt">.width =</span> <span class="fl">.80</span>)</a></code></pre></div>
<pre><code>## # A tibble: 2 x 6
##           x .lower .upper .width .point .interval
##       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 -0.000854  -1.53   1.60    0.8 mode   hdi      
## 2 -0.000854   3.03   4.98    0.8 mode   hdi</code></pre>
<p>This is easier to see when plotted:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb45-1" data-line-number="1">multimodal_draws <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb45-2" data-line-number="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> x)) <span class="op">+</span></a>
<a class="sourceLine" id="cb45-3" data-line-number="3"><span class="st">  </span><span class="kw">stat_density</span>(<span class="dt">fill =</span> <span class="st">"gray75"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb45-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/stat_pointinterval.html">stat_pointintervalh</a></span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="fl">-0.05</span>), <span class="dt">point_interval =</span> median_qi, <span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.80</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb45-5" data-line-number="5"><span class="st">  </span><span class="kw">annotate</span>(<span class="st">"text"</span>, <span class="dt">label =</span> <span class="st">"median, 80% and 95% quantile intervals"</span>, <span class="dt">x =</span> <span class="dv">6</span>, <span class="dt">y =</span> <span class="fl">-0.05</span>, <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">vjust =</span> <span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb45-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/stat_pointinterval.html">stat_pointintervalh</a></span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="fl">-0.025</span>), <span class="dt">point_interval =</span> mode_hdi, <span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.80</span>)) <span class="op">+</span></a>
<a class="sourceLine" id="cb45-7" data-line-number="7"><span class="st">  </span><span class="kw">annotate</span>(<span class="st">"text"</span>, <span class="dt">label =</span> <span class="st">"mode, 80% and 95% highest-density intervals"</span>, <span class="dt">x =</span> <span class="dv">6</span>, <span class="dt">y =</span> <span class="fl">-0.025</span>, <span class="dt">hjust =</span> <span class="dv">0</span>, <span class="dt">vjust =</span> <span class="fl">0.3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb45-8" data-line-number="8"><span class="st">  </span><span class="kw">xlim</span>(<span class="op">-</span><span class="fl">3.5</span>, <span class="fl">14.5</span>)</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-31-1.png" width="768"></p>
</div>
</div>
<div id="combining-variables-with-different-indices-in-a-single-tidy-format-data-frame" class="section level2">
<h2 class="hasAnchor">
<a href="#combining-variables-with-different-indices-in-a-single-tidy-format-data-frame" class="anchor"></a>Combining variables with different indices in a single tidy format data frame</h2>
<p><code>spread_draws</code> supports extracting variables that have different indices. It automatically matches up indices with the same name, and duplicates values as necessary to produce one row per all combination of levels of all indices. For example, we might want to calculate the difference between each condition mean and the overall mean. To do that, we can extract draws from the overall mean and all condition means:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb46-1" data-line-number="1">m <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb46-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(overall_mean, condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb46-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 6
## # Groups:   condition [5]
##    .chain .iteration .draw overall_mean condition condition_mean
##     &lt;int&gt;      &lt;int&gt; &lt;int&gt;        &lt;dbl&gt; &lt;fct&gt;              &lt;dbl&gt;
##  1      1          1     1        0.810 A                -0.0488
##  2      1          1     1        0.810 B                 1.19  
##  3      1          1     1        0.810 C                 1.90  
##  4      1          1     1        0.810 D                 0.962 
##  5      1          1     1        0.810 E                -0.878 
##  6      1          2     2        0.762 A                 0.193 
##  7      1          2     2        0.762 B                 1.07  
##  8      1          2     2        0.762 C                 1.97  
##  9      1          2     2        0.762 D                 1.12  
## 10      1          2     2        0.762 E                -1.09</code></pre>
<p><em>(10 rows of 20000)</em></p>
<p>Within each draw, <code>overall_mean</code> is repeated as necessary to correspond to every index of <code>condition_mean</code>. Thus, the <code>mutate</code> function from dplyr can be used to take the differences over all rows, then we can summarize with <code>median_qi</code>:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb48-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(overall_mean, condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">condition_offset =</span> condition_mean <span class="op">-</span><span class="st"> </span>overall_mean) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb48-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>(condition_offset)</a></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   condition condition_offset  .lower .upper .width .point .interval
##   &lt;fct&gt;                &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 A                   -0.398 -1.59    0.803   0.95 median qi       
## 2 B                    0.408 -0.756   1.62    0.95 median qi       
## 3 C                    1.24   0.0928  2.47    0.95 median qi       
## 4 D                    0.416 -0.737   1.63    0.95 median qi       
## 5 E                   -1.47  -2.65   -0.301   0.95 median qi</code></pre>
</div>
<div id="posterior-predictions" class="section level2">
<h2 class="hasAnchor">
<a href="#posterior-predictions" class="anchor"></a>Posterior predictions</h2>
<p>We can use combinations of variables with difference indices to generate predictions from the model. In this case, we can combine the condition means with the residual standard deviation to generate predictive distributions from the model:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb50-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb50-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition], response_sd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb50-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_rep =</span> <span class="kw">rnorm</span>(<span class="kw">n</span>(), condition_mean, response_sd)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb50-4" data-line-number="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> y_rep)) <span class="op">+</span></a>
<a class="sourceLine" id="cb50-5" data-line-number="5"><span class="st">  </span><span class="kw">stat_density</span>(<span class="dt">fill =</span> <span class="st">"gray75"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb50-6" data-line-number="6"><span class="st">  </span><span class="kw">facet_grid</span>(condition <span class="op">~</span><span class="st"> </span>., <span class="dt">switch =</span> <span class="st">"y"</span>)</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-34-1.png" width="576"></p>
<p>And even summarize these as predictive intervals and compare them to the data:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb51-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition], response_sd) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_rep =</span> <span class="kw">rnorm</span>(<span class="kw">n</span>(), condition_mean, response_sd)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>(y_rep, <span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.8</span>, <span class="fl">.5</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb51-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> <span class="kw">fct_rev</span>(condition), <span class="dt">x =</span> y_rep)) <span class="op">+</span></a>
<a class="sourceLine" id="cb51-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/geom_interval.html">geom_intervalh</a></span>() <span class="op">+</span><span class="st"> </span><span class="co">#auto-sets aes(xmin = .lower, xmax = .upper, color = fct_rev(ordered(.width)))</span></a>
<a class="sourceLine" id="cb51-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> response), <span class="dt">data =</span> ABC) <span class="op">+</span></a>
<a class="sourceLine" id="cb51-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_color_brewer</span>()</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-35-1.png" width="576"></p>
<p>If this model is well-calibrated, about 95% of the data should be within the outer intervals, 80% in the next-smallest intervals, and 50% in the smallest intervals.</p>
<div id="posterior-predictions-with-posterior-distributions-of-means" class="section level3">
<h3 class="hasAnchor">
<a href="#posterior-predictions-with-posterior-distributions-of-means" class="anchor"></a>Posterior predictions with posterior distributions of means</h3>
<p>Altogether, data, posterior predictions, and posterior distributions of the means:</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb52-1" data-line-number="1">draws =<span class="st"> </span>m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition], response_sd)</a>
<a class="sourceLine" id="cb52-3" data-line-number="3"></a>
<a class="sourceLine" id="cb52-4" data-line-number="4">reps =<span class="st"> </span>draws <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">y_rep =</span> <span class="kw">rnorm</span>(<span class="kw">n</span>(), condition_mean, response_sd)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>(y_rep, <span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.8</span>, <span class="fl">.5</span>))</a>
<a class="sourceLine" id="cb52-7" data-line-number="7"></a>
<a class="sourceLine" id="cb52-8" data-line-number="8">means =<span class="st"> </span>draws <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-9" data-line-number="9"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>(condition_mean, <span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.66</span>))</a>
<a class="sourceLine" id="cb52-10" data-line-number="10"></a>
<a class="sourceLine" id="cb52-11" data-line-number="11">ABC <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb52-12" data-line-number="12"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> condition)) <span class="op">+</span></a>
<a class="sourceLine" id="cb52-13" data-line-number="13"><span class="st">  </span><span class="kw"><a href="../reference/geom_interval.html">geom_intervalh</a></span>(<span class="kw">aes</span>(<span class="dt">x =</span> y_rep), <span class="dt">data =</span> reps) <span class="op">+</span></a>
<a class="sourceLine" id="cb52-14" data-line-number="14"><span class="st">  </span><span class="kw"><a href="../reference/geom_pointinterval.html">geom_pointintervalh</a></span>(<span class="kw">aes</span>(<span class="dt">x =</span> condition_mean), <span class="dt">position =</span> <span class="kw">position_nudge</span>(<span class="dt">y =</span> <span class="fl">-0.2</span>), <span class="dt">data =</span> means) <span class="op">+</span></a>
<a class="sourceLine" id="cb52-15" data-line-number="15"><span class="st">  </span><span class="kw">geom_point</span>(<span class="kw">aes</span>(<span class="dt">x =</span> response)) <span class="op">+</span></a>
<a class="sourceLine" id="cb52-16" data-line-number="16"><span class="st">  </span><span class="kw">scale_color_brewer</span>()</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-36-1.png" width="576"></p>
</div>
</div>
<div id="comparing-levels-of-a-factor" class="section level2">
<h2 class="hasAnchor">
<a href="#comparing-levels-of-a-factor" class="anchor"></a>Comparing levels of a factor</h2>
<p><code>compare_levels</code> allows us to compare the value of some variable across levels of some factor. By default it computes all pairwise differences, though this can be changed using the <code>comparison =</code> argument:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb53-1" data-line-number="1"><span class="co">#N.B. the syntax for compare_levels is experimental and may change</span></a>
<a class="sourceLine" id="cb53-2" data-line-number="2">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/compare_levels.html">compare_levels</a></span>(condition_mean, <span class="dt">by =</span> condition) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb53-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> condition, <span class="dt">x =</span> condition_mean)) <span class="op">+</span></a>
<a class="sourceLine" id="cb53-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/geom_halfeyeh.html">geom_halfeyeh</a></span>()</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-37-1.png" width="672"></p>
</div>
<div id="gathering-all-model-variable-names-into-a-single-column-gather_draws-and-gather_variables" class="section level2">
<h2 class="hasAnchor">
<a href="#gathering-all-model-variable-names-into-a-single-column-gather_draws-and-gather_variables" class="anchor"></a>Gathering all model variable names into a single column: <code>gather_draws</code> and <code>gather_variables</code>
</h2>
<p>We might also prefer all model variable names to be in a single column (long-format) instead of as column names. There are two methods for obtaining long-format data frames with <code>tidybayes</code>, whose use depends on where and how in the data processing chain you might want to transform into long-format: <code>gather_draws</code> and <code>gather_variables</code>. There are also two methods for wide (or semi-wide) format data frame, <code>spread_draws</code> (described previously) and <code>tidy_draws</code>.</p>
<p><code>gather_draws</code> is the counterpart to <code>spread_draws</code>, except it puts all variable names in a <code>.variable</code> column and all draws in a <code>.value</code> column:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb54-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb54-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">gather_draws</a></span>(overall_mean, condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb54-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>()</a></code></pre></div>
<pre><code>## # A tibble: 6 x 8
## # Groups:   .variable [2]
##   .variable      condition .value .lower .upper .width .point .interval
##   &lt;chr&gt;          &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 condition_mean A          0.191 -0.137  0.548   0.95 median qi       
## 2 condition_mean B          1.00   0.656  1.35    0.95 median qi       
## 3 condition_mean C          1.84   1.49   2.18    0.95 median qi       
## 4 condition_mean D          1.01   0.654  1.37    0.95 median qi       
## 5 condition_mean E         -0.894 -1.24  -0.544   0.95 median qi       
## 6 overall_mean   &lt;NA&gt;       0.586 -0.587  1.69    0.95 median qi</code></pre>
<p>Note that <code>condition = NA</code> for the <code>overall_mean</code> row, because it does not have an index with that name in the specification passed to <code>gather_draws</code>.</p>
<p>While this works well if we do not need to perform computations that involve multiple columns, the semi-wide format returned by <code>spread_draws</code> is very useful for computations that involve multiple columns names, such as the calculation of the <code>condition_offset</code> above. If we want to make intermediate computations on the format returned by <code>spread_draws</code> and <em>then</em> gather variables into one column, we can use <code>gather_variables</code>, which will gather all non-grouped variables that are not special columns (like <code>.chain</code>, <code>.iteration</code>, or <code>.draw</code>):</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb56-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb56-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(overall_mean, condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb56-3" data-line-number="3"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">condition_offset =</span> condition_mean <span class="op">-</span><span class="st"> </span>overall_mean) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb56-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/gather_variables.html">gather_variables</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb56-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>()</a></code></pre></div>
<pre><code>## # A tibble: 15 x 8
## # Groups:   condition [5]
##    condition .variable        .value  .lower .upper .width .point .interval
##    &lt;fct&gt;     &lt;chr&gt;             &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
##  1 A         condition_mean    0.191 -0.137   0.548   0.95 median qi       
##  2 A         condition_offset -0.398 -1.59    0.803   0.95 median qi       
##  3 A         overall_mean      0.586 -0.587   1.69    0.95 median qi       
##  4 B         condition_mean    1.00   0.656   1.35    0.95 median qi       
##  5 B         condition_offset  0.408 -0.756   1.62    0.95 median qi       
##  6 B         overall_mean      0.586 -0.587   1.69    0.95 median qi       
##  7 C         condition_mean    1.84   1.49    2.18    0.95 median qi       
##  8 C         condition_offset  1.24   0.0928  2.47    0.95 median qi       
##  9 C         overall_mean      0.586 -0.587   1.69    0.95 median qi       
## 10 D         condition_mean    1.01   0.654   1.37    0.95 median qi       
## 11 D         condition_offset  0.416 -0.737   1.63    0.95 median qi       
## 12 D         overall_mean      0.586 -0.587   1.69    0.95 median qi       
## 13 E         condition_mean   -0.894 -1.24   -0.544   0.95 median qi       
## 14 E         condition_offset -1.47  -2.65   -0.301   0.95 median qi       
## 15 E         overall_mean      0.586 -0.587   1.69    0.95 median qi</code></pre>
<p>Note how <code>overall_mean</code> is now repeated here for each condition, because we have performed the gather after spreading model variables across columns.</p>
<p>Finally, if we want raw model variable names as columns names instead of having indices split out as their own column names, we can use <code>tidy_draws</code>. Generally speaking <code>spread_draws</code> and <code>gather_draws</code> are typically more useful that <code>tidy_draws</code>, but it is provided as a common method for generating data frames from many types of Bayesian models, and is used internally by <code>gather_draws</code> and <code>spread_draws</code>:</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb58-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb58-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/tidy_draws.html">tidy_draws</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb58-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 17
##    .chain .iteration .draw overall_mean `condition_zoff~ `condition_zoff~ `condition_zoff~
##     &lt;int&gt;      &lt;int&gt; &lt;int&gt;        &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1      1          1     1        0.810          -0.743            0.330             0.941
##  2      1          2     2        0.762          -0.441            0.239             0.941
##  3      1          3     3        0.689          -0.358            0.0563            0.751
##  4      1          4     4        0.845          -0.564            0.277             0.573
##  5      1          5     5        0.626          -0.234            0.225             0.976
##  6      1          6     6        0.431          -0.0670           1.04              1.74 
##  7      1          7     7        0.475          -0.658            0.553             1.75 
##  8      1          8     8        0.542          -0.409            0.680             1.74 
##  9      1          9     9        1.24           -0.730           -0.387             0.717
## 10      1         10    10        1.14           -0.690           -0.265             0.805
## # ... with 10 more variables: `condition_zoffset[4]` &lt;dbl&gt;, `condition_zoffset[5]` &lt;dbl&gt;,
## #   response_sd &lt;dbl&gt;, condition_mean_sd &lt;dbl&gt;, `condition_mean[1]` &lt;dbl&gt;,
## #   `condition_mean[2]` &lt;dbl&gt;, `condition_mean[3]` &lt;dbl&gt;, `condition_mean[4]` &lt;dbl&gt;,
## #   `condition_mean[5]` &lt;dbl&gt;, lp__ &lt;dbl&gt;</code></pre>
<p><em>(10 rows of 4000)</em></p>
<p>Combining <code>tidy_draws</code> with <code>gather_variables</code> also allows us to derive similar output to <code><a href="http://www.rdocumentation.org/packages/ggmcmc/topics/ggs">ggmcmc::ggs</a></code>, if desired:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb60-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb60-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/tidy_draws.html">tidy_draws</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb60-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/gather_variables.html">gather_variables</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb60-4" data-line-number="4"><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 5
## # Groups:   .variable [1]
##    .chain .iteration .draw .variable    .value
##     &lt;int&gt;      &lt;int&gt; &lt;int&gt; &lt;chr&gt;         &lt;dbl&gt;
##  1      1          1     1 overall_mean  0.810
##  2      1          2     2 overall_mean  0.762
##  3      1          3     3 overall_mean  0.689
##  4      1          4     4 overall_mean  0.845
##  5      1          5     5 overall_mean  0.626
##  6      1          6     6 overall_mean  0.431
##  7      1          7     7 overall_mean  0.475
##  8      1          8     8 overall_mean  0.542
##  9      1          9     9 overall_mean  1.24 
## 10      1         10    10 overall_mean  1.14</code></pre>
<p><em>(10 rows of 56000)</em></p>
<p>But again, this approach does not handle variable indices for us automatically, so using <code>spread_draws</code> and <code>gather_draws</code> is generally recommended unless you do not have variable indices to worry about.</p>
</div>
<div id="selecting-variables-using-regular-expressions" class="section level2">
<h2 class="hasAnchor">
<a href="#selecting-variables-using-regular-expressions" class="anchor"></a>Selecting variables using regular expressions</h2>
<p>You can use regular expressions in the specifications passed to <code>spread_draws</code> and <code>gather_draws</code> to match multiple columns by passing <code>regex = TRUE</code>. Our example fit contains variables named <code>condition_mean[i]</code> and <code>condition_zoffset[i]</code>. We could extract both using a single regular expression:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb62-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb62-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(<span class="st">`</span><span class="dt">condition_.*</span><span class="st">`</span>[condition], <span class="dt">regex =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb62-3" data-line-number="3"><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 6
## # Groups:   condition [5]
##    .chain .iteration .draw condition condition_mean condition_zoffset
##     &lt;int&gt;      &lt;int&gt; &lt;int&gt; &lt;fct&gt;              &lt;dbl&gt;             &lt;dbl&gt;
##  1      1          1     1 A                -0.0488            -0.743
##  2      1          1     1 B                 1.19               0.330
##  3      1          1     1 C                 1.90               0.941
##  4      1          1     1 D                 0.962              0.131
##  5      1          1     1 E                -0.878             -1.46 
##  6      1          2     2 A                 0.193             -0.441
##  7      1          2     2 B                 1.07               0.239
##  8      1          2     2 C                 1.97               0.941
##  9      1          2     2 D                 1.12               0.281
## 10      1          2     2 E                -1.09              -1.44</code></pre>
<p><em>(10 rows of 20000)</em></p>
<p>This result is equivalent in this case to <code><a href="../reference/spread_draws.html">spread_draws(c(condition_mean, condition_zoffset)[condition])</a></code>, but does not require us to list each variable explicitly—this can be useful, for example, in models with naming schemes like <code>b_[some name]</code> for coefficients.</p>
</div>
<div id="drawing-fit-curves-with-uncertainty" class="section level2">
<h2 class="hasAnchor">
<a href="#drawing-fit-curves-with-uncertainty" class="anchor"></a>Drawing fit curves with uncertainty</h2>
<p>To demonstrate drawing fit curves with uncertainty, let’s fit a slightly naive model to part of the <code>mtcars</code> dataset using <code>brm</code>:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb64-1" data-line-number="1">m_mpg =<span class="st"> </span><span class="kw">brm</span>(mpg <span class="op">~</span><span class="st"> </span>hp <span class="op">*</span><span class="st"> </span>cyl, <span class="dt">data =</span> mtcars)</a></code></pre></div>
<p>We can draw fit curves with probability bands using <code><a href="../reference/add_predicted_draws.html">tidybayes::add_fitted_draws</a></code> and <code><a href="../reference/stat_lineribbon.html">tidybayes::stat_lineribbon</a></code>:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb65-1" data-line-number="1">mtcars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb65-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(cyl) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb65-3" data-line-number="3"><span class="st">  </span><span class="kw">data_grid</span>(<span class="dt">hp =</span> <span class="kw">seq_range</span>(hp, <span class="dt">n =</span> <span class="dv">51</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb65-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/add_predicted_draws.html">add_fitted_draws</a></span>(m_mpg) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb65-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> hp, <span class="dt">y =</span> mpg, <span class="dt">color =</span> <span class="kw">ordered</span>(cyl))) <span class="op">+</span></a>
<a class="sourceLine" id="cb65-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/stat_lineribbon.html">stat_lineribbon</a></span>(<span class="kw">aes</span>(<span class="dt">y =</span> .value)) <span class="op">+</span></a>
<a class="sourceLine" id="cb65-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mtcars) <span class="op">+</span></a>
<a class="sourceLine" id="cb65-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">"Greys"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb65-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">"Set2"</span>)</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-44-1.png" width="576"></p>
<p>Or we can sample a reasonable number of fit lines (say 100) and overplot them:</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb66-1" data-line-number="1">mtcars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb66-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(cyl) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb66-3" data-line-number="3"><span class="st">  </span><span class="kw">data_grid</span>(<span class="dt">hp =</span> <span class="kw">seq_range</span>(hp, <span class="dt">n =</span> <span class="dv">101</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb66-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/add_predicted_draws.html">add_fitted_draws</a></span>(m_mpg, <span class="dt">n =</span> <span class="dv">100</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb66-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> hp, <span class="dt">y =</span> mpg, <span class="dt">color =</span> <span class="kw">ordered</span>(cyl))) <span class="op">+</span></a>
<a class="sourceLine" id="cb66-6" data-line-number="6"><span class="st">  </span><span class="kw">geom_line</span>(<span class="kw">aes</span>(<span class="dt">y =</span> .value, <span class="dt">group =</span> <span class="kw">paste</span>(cyl, .draw)), <span class="dt">alpha =</span> <span class="fl">.1</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb66-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mtcars) <span class="op">+</span></a>
<a class="sourceLine" id="cb66-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">"Dark2"</span>)</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-45-1.png" width="576"></p>
<p>Or, for posterior predictions (instead of fits), we can go back to probability bands:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb67-1" data-line-number="1">mtcars <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb67-2" data-line-number="2"><span class="st">  </span><span class="kw">group_by</span>(cyl) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb67-3" data-line-number="3"><span class="st">  </span><span class="kw">data_grid</span>(<span class="dt">hp =</span> <span class="kw">seq_range</span>(hp, <span class="dt">n =</span> <span class="dv">101</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb67-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/add_predicted_draws.html">add_predicted_draws</a></span>(m_mpg) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb67-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> hp, <span class="dt">y =</span> mpg, <span class="dt">color =</span> <span class="kw">ordered</span>(cyl), <span class="dt">fill =</span> <span class="kw">ordered</span>(cyl))) <span class="op">+</span></a>
<a class="sourceLine" id="cb67-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/stat_lineribbon.html">stat_lineribbon</a></span>(<span class="kw">aes</span>(<span class="dt">y =</span> .prediction), <span class="dt">.width =</span> <span class="kw">c</span>(.<span class="dv">95</span>, <span class="fl">.80</span>, <span class="fl">.50</span>), <span class="dt">alpha =</span> <span class="dv">1</span><span class="op">/</span><span class="dv">4</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb67-7" data-line-number="7"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">data =</span> mtcars) <span class="op">+</span></a>
<a class="sourceLine" id="cb67-8" data-line-number="8"><span class="st">  </span><span class="kw">scale_fill_brewer</span>(<span class="dt">palette =</span> <span class="st">"Set2"</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb67-9" data-line-number="9"><span class="st">  </span><span class="kw">scale_color_brewer</span>(<span class="dt">palette =</span> <span class="st">"Dark2"</span>)</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-46-1.png" width="576"></p>
<p>For more examples of curve-drawing, see <code><a href="../articles/tidy-brms.html">vignette("tidy-brms")</a></code> or <code><a href="../articles/tidy-rstanarm.html">vignette("tidy-rstanarm")</a></code>.</p>
</div>
<div id="compatibility-with-other-packages" class="section level2">
<h2 class="hasAnchor">
<a href="#compatibility-with-other-packages" class="anchor"></a>Compatibility with other packages</h2>
<div id="compatibility-of-point_interval-with-broomtidy-and-dotwhiskerdwplot-a-model-comparison-example" class="section level3">
<h3 class="hasAnchor">
<a href="#compatibility-of-point_interval-with-broomtidy-and-dotwhiskerdwplot-a-model-comparison-example" class="anchor"></a>Compatibility of <code>point_interval</code> with <code><a href="http://www.rdocumentation.org/packages/broom/topics/tidy">broom::tidy</a></code> and <code><a href="http://www.rdocumentation.org/packages/dotwhisker/topics/dwplot">dotwhisker::dwplot</a></code>: A model comparison example</h3>
<p>Combining <code>to_broom_names</code> with <code>median_qi</code> (or more generally, the <code>point_interval</code> family of functions) makes it is easy to compare results against models supported by <code><a href="http://www.rdocumentation.org/packages/broom/topics/tidy">broom::tidy</a></code>. For example, let’s compare our model’s fits for conditional means against an ordinary least squares (OLS) regression:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb68-1" data-line-number="1">m_linear =<span class="st"> </span><span class="kw">lm</span>(response <span class="op">~</span><span class="st"> </span>condition, <span class="dt">data =</span> ABC)</a></code></pre></div>
<p>Combining <code><a href="http://www.rdocumentation.org/packages/emmeans/topics/emmeans">emmeans::emmeans</a></code> with <code><a href="http://www.rdocumentation.org/packages/broom/topics/tidy">broom::tidy</a></code>, we can generate tidy-format summaries of conditional means from the above model:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb69-1" data-line-number="1">linear_results =<span class="st"> </span>m_linear <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb69-2" data-line-number="2"><span class="st">  </span><span class="kw">emmeans</span>(<span class="op">~</span><span class="st"> </span>condition) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb69-3" data-line-number="3"><span class="st">  </span><span class="kw">tidy</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb69-4" data-line-number="4"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">"OLS"</span>)</a>
<a class="sourceLine" id="cb69-5" data-line-number="5"></a>
<a class="sourceLine" id="cb69-6" data-line-number="6">linear_results</a></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   condition estimate std.error    df conf.low conf.high model
##   &lt;fct&gt;        &lt;dbl&gt;     &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;
## 1 A            0.182     0.173    45   -0.167     0.530 OLS  
## 2 B            1.01      0.173    45    0.665     1.36  OLS  
## 3 C            1.87      0.173    45    1.53      2.22  OLS  
## 4 D            1.03      0.173    45    0.678     1.38  OLS  
## 5 E           -0.935     0.173    45   -1.28     -0.586 OLS</code></pre>
<p>We can derive corresponding fits from our model:</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb71-1" data-line-number="1">bayes_results =<span class="st"> </span>m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb71-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb71-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>(<span class="dt">estimate =</span> condition_mean) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb71-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/tidy-format-translators.html">to_broom_names</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb71-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">model =</span> <span class="st">"Bayes"</span>)</a>
<a class="sourceLine" id="cb71-6" data-line-number="6"></a>
<a class="sourceLine" id="cb71-7" data-line-number="7">bayes_results</a></code></pre></div>
<pre><code>## # A tibble: 5 x 8
##   condition estimate conf.low conf.high .width .point .interval model
##   &lt;fct&gt;        &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;     &lt;chr&gt;
## 1 A            0.191   -0.137     0.548   0.95 median qi        Bayes
## 2 B            1.00     0.656     1.35    0.95 median qi        Bayes
## 3 C            1.84     1.49      2.18    0.95 median qi        Bayes
## 4 D            1.01     0.654     1.37    0.95 median qi        Bayes
## 5 E           -0.894   -1.24     -0.544   0.95 median qi        Bayes</code></pre>
<p>Here, <code>to_broom_names</code> will convert <code>.lower</code> and <code>.upper</code> into <code>conf.low</code> and <code>conf.high</code> so the names of the columns we need to make the comparison (<code>condition</code>, <code>estimate</code>, <code>conf.low</code>, and <code>conf.high</code>) all line up easily. This makes it simple to combine the two tidy data frames together using <code>bind_rows</code>, and plot them:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb73-1" data-line-number="1"><span class="kw">bind_rows</span>(linear_results, bayes_results) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb73-2" data-line-number="2"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">condition =</span> <span class="kw">fct_rev</span>(condition)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb73-3" data-line-number="3"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">y =</span> condition, <span class="dt">x =</span> estimate, <span class="dt">xmin =</span> conf.low, <span class="dt">xmax =</span> conf.high, <span class="dt">color =</span> model)) <span class="op">+</span></a>
<a class="sourceLine" id="cb73-4" data-line-number="4"><span class="st">  </span><span class="kw">geom_pointrangeh</span>(<span class="dt">position =</span> <span class="kw">position_dodgev</span>(<span class="dt">height =</span> <span class="fl">.3</span>))</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-50-1.png" width="576"></p>
<p>Compatibility with <code>tidy</code> also gives compatibility with <code><a href="http://www.rdocumentation.org/packages/dotwhisker/topics/dwplot">dotwhisker::dwplot</a></code>:</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb74-1" data-line-number="1"><span class="kw">bind_rows</span>(linear_results, bayes_results) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb74-2" data-line-number="2"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">term =</span> condition) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb74-3" data-line-number="3"><span class="st">  </span>dotwhisker<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/dotwhisker/topics/dwplot">dwplot</a></span>()</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-51-1.png" width="576"></p>
<p>Observe the shrinkage towards the overall mean in the Bayesian model compared to the OLS model.</p>
</div>
<div id="compatibility-with-bayesplot-using-unspread_draws-and-ungather_draws" class="section level3">
<h3 class="hasAnchor">
<a href="#compatibility-with-bayesplot-using-unspread_draws-and-ungather_draws" class="anchor"></a>Compatibility with <code>bayesplot</code> using <code>unspread_draws</code> and <code>ungather_draws</code>
</h3>
<p>Functions from other packages might expect draws in the form of a data frame or matrix with variables as columns and draws as rows. That is the format returned by <code>tidy_draws</code>, but not by <code>gather_draws</code> or <code>spread_draws</code>, which split indices from variables out into columns.</p>
<p>It may be desirable to use the <code>spread_draws</code> or <code>gather_draws</code> functions to transform your draws in some way, and then convert them <em>back</em> into the draw <span class="math inline">\(\times\)</span> variable format to pass them into functions from other packages, like <code>bayesplot</code>. The <code>unspread_draws</code> and <code>ungather_draws</code> functions invert <code>spread_draws</code> and <code>gather_draws</code> to return a data frame with variable column names that include indices in them and draws as rows.</p>
<p>As an example, let’s re-do the previous example of <code>compare_levels</code>, but use <code><a href="http://www.rdocumentation.org/packages/bayesplot/topics/MCMC-distributions">bayesplot::mcmc_hist</a></code> to plot the results instead of <code>geom_eyeh</code>. First, the result of <code>compare_levels</code> looks like this:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb75-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/compare_levels.html">compare_levels</a></span>(condition_mean, <span class="dt">by =</span> condition) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb75-4" data-line-number="4"><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 5
## # Groups:   condition [1]
##    .chain .iteration .draw condition condition_mean
##     &lt;int&gt;      &lt;int&gt; &lt;int&gt; &lt;fct&gt;              &lt;dbl&gt;
##  1      1          1     1 B - A              1.24 
##  2      1          2     2 B - A              0.877
##  3      1          3     3 B - A              0.493
##  4      1          4     4 B - A              1.32 
##  5      1          5     5 B - A              0.502
##  6      1          6     6 B - A              0.864
##  7      1          7     7 B - A              1.16 
##  8      1          8     8 B - A              0.728
##  9      1          9     9 B - A              0.258
## 10      1         10    10 B - A              0.363</code></pre>
<p><em>(10 rows of 40000)</em></p>
<p>To get a version we can pass to <code>mcmc_hist</code>, all we need to do is invert the <code>spread_draws</code> call we started with:</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb77-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/compare_levels.html">compare_levels</a></span>(condition_mean, <span class="dt">by =</span> condition) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/unspread_draws.html">unspread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb77-5" data-line-number="5"><span class="st">  </span><span class="kw">head</span>(<span class="dv">10</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 13
##    .chain .iteration .draw `condition_mean~ `condition_mean~ `condition_mean~ `condition_mean~
##     &lt;int&gt;      &lt;int&gt; &lt;int&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;
##  1      1          1     1            1.24              1.95            0.706            1.01 
##  2      1          2     2            0.877             1.78            0.905            0.931
##  3      1          3     3            0.493             1.32            0.827            0.901
##  4      1          4     4            1.32              1.79            0.466            0.906
##  5      1          5     5            0.502             1.32            0.822            0.567
##  6      1          6     6            0.864             1.41            0.544            0.662
##  7      1          7     7            1.16              2.31            1.15             1.23 
##  8      1          8     8            0.728             1.44            0.707            0.820
##  9      1          9     9            0.258             1.09            0.831            0.484
## 10      1         10    10            0.363             1.28            0.914            0.498
## # ... with 6 more variables: `condition_mean[D - B]` &lt;dbl&gt;, `condition_mean[D - C]` &lt;dbl&gt;,
## #   `condition_mean[E - A]` &lt;dbl&gt;, `condition_mean[E - B]` &lt;dbl&gt;, `condition_mean[E - C]` &lt;dbl&gt;,
## #   `condition_mean[E - D]` &lt;dbl&gt;</code></pre>
<p><em>(10 rows of 4000)</em></p>
<p>We can pass that into <code><a href="http://www.rdocumentation.org/packages/bayesplot/topics/MCMC-intervals">bayesplot::mcmc_areas</a></code> directly. The <code>drop_indices = TRUE</code> argument to <code>unspread_draws</code> indicates that <code>.chain</code>, <code>.iteration</code>, and <code>.draw</code> should not be included in the output:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb79-1" data-line-number="1">m <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-2" data-line-number="2"><span class="st">  </span><span class="kw"><a href="../reference/spread_draws.html">spread_draws</a></span>(condition_mean[condition]) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/compare_levels.html">compare_levels</a></span>(condition_mean, <span class="dt">by =</span> condition) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/unspread_draws.html">unspread_draws</a></span>(condition_mean[condition], <span class="dt">drop_indices =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb79-5" data-line-number="5"><span class="st">  </span><span class="kw">mcmc_areas</span>()</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-54-1.png" width="576"></p>
<p>If you are instead working with tidy draws generated by <code>gather_draws</code> or <code>gather_variables</code>, the <code>ungather_draws</code> function will transform those draws into the draw <span class="math inline">\(\times\)</span> variable format. It has the same syntax as <code>unspread_draws</code>.</p>
</div>
<div id="compatibility-with-emmeans-formerly-lsmeans" class="section level3">
<h3 class="hasAnchor">
<a href="#compatibility-with-emmeans-formerly-lsmeans" class="anchor"></a>Compatibility with <code>emmeans</code> (formerly <code>lsmeans</code>)</h3>
<p>The <code>emmeans</code> package provides a convenient syntax for generating marginal estimates from a model, including numerous types of contrasts. It also supports some Bayesian modeling packages, like <code>MCMCglmm</code> and <code>rstanarm</code>. However, it does not provide draws in a tidy format. The <code>gather_emmeans_draws</code> function converts output from <code>emmeans</code> into a tidy format, keeping the <code>emmeans</code> reference grid and adding a <code>.value</code> column with long-format draws.</p>
<p>For example, given this <code>rstanarm</code> model:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb80-1" data-line-number="1">m_rst =<span class="st"> </span><span class="kw">stan_glm</span>(response <span class="op">~</span><span class="st"> </span>condition, <span class="dt">data =</span> ABC)</a></code></pre></div>
<p>We can use <code><a href="http://www.rdocumentation.org/packages/emmeans/topics/emmeans">emmeans::emmeans</a></code> to get conditional means with uncertainty:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb81-1" data-line-number="1">m_rst <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb81-2" data-line-number="2"><span class="st">  </span><span class="kw">emmeans</span>( <span class="op">~</span><span class="st"> </span>condition) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb81-3" data-line-number="3"><span class="st">  </span><span class="kw"><a href="../reference/gather_emmeans_draws.html">gather_emmeans_draws</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb81-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>()</a></code></pre></div>
<pre><code>## # A tibble: 5 x 7
##   condition .value .lower .upper .width .point .interval
##   &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
## 1 A          0.194 -0.147  0.555   0.95 median qi       
## 2 B          1.01   0.655  1.37    0.95 median qi       
## 3 C          1.87   1.50   2.22    0.95 median qi       
## 4 D          1.03   0.670  1.38    0.95 median qi       
## 5 E         -0.931 -1.26  -0.586   0.95 median qi</code></pre>
<p>Or <code><a href="http://www.rdocumentation.org/packages/emmeans/topics/emmeans">emmeans::emmeans</a></code> with <code><a href="http://www.rdocumentation.org/packages/emmeans/topics/contrast">emmeans::contrast</a></code> to do all pairwise comparisons:</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb83-1" data-line-number="1">m_rst <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb83-2" data-line-number="2"><span class="st">  </span><span class="kw">emmeans</span>( <span class="op">~</span><span class="st"> </span>condition) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb83-3" data-line-number="3"><span class="st">  </span><span class="kw">contrast</span>(<span class="dt">method =</span> <span class="st">"pairwise"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb83-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/gather_emmeans_draws.html">gather_emmeans_draws</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb83-5" data-line-number="5"><span class="st">  </span><span class="kw"><a href="../reference/point_interval.html">median_qi</a></span>()</a></code></pre></div>
<pre><code>## # A tibble: 10 x 7
##    contrast  .value .lower .upper .width .point .interval
##    &lt;fct&gt;      &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt;  &lt;chr&gt;    
##  1 A - B    -0.814  -1.30  -0.304   0.95 median qi       
##  2 A - C    -1.67   -2.17  -1.17    0.95 median qi       
##  3 A - D    -0.829  -1.33  -0.337   0.95 median qi       
##  4 A - E     1.13    0.639  1.61    0.95 median qi       
##  5 B - C    -0.854  -1.35  -0.355   0.95 median qi       
##  6 B - D    -0.0133 -0.524  0.488   0.95 median qi       
##  7 B - E     1.94    1.45   2.43    0.95 median qi       
##  8 C - D     0.842   0.345  1.34    0.95 median qi       
##  9 C - E     2.79    2.29   3.29    0.95 median qi       
## 10 D - E     1.95    1.45   2.45    0.95 median qi</code></pre>
<p>See <code>?pairwise.emmc</code> for a list of the numerous contrast types supported by <code>emmeans</code>.</p>
<p>As before, we can plot the results instead of using a table:</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb85-1" data-line-number="1">m_rst <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb85-2" data-line-number="2"><span class="st">  </span><span class="kw">emmeans</span>( <span class="op">~</span><span class="st"> </span>condition) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb85-3" data-line-number="3"><span class="st">  </span><span class="kw">contrast</span>(<span class="dt">method =</span> <span class="st">"pairwise"</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb85-4" data-line-number="4"><span class="st">  </span><span class="kw"><a href="../reference/gather_emmeans_draws.html">gather_emmeans_draws</a></span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb85-5" data-line-number="5"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> .value, <span class="dt">y =</span> contrast)) <span class="op">+</span></a>
<a class="sourceLine" id="cb85-6" data-line-number="6"><span class="st">  </span><span class="kw"><a href="../reference/geom_halfeyeh.html">geom_halfeyeh</a></span>()</a></code></pre></div>
<p><img src="tidybayes_files/figure-html/unnamed-chunk-58-1.png" width="576"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction">Introduction</a></li>
      <li><a href="#setup">Setup</a></li>
      <li><a href="#example-dataset">Example dataset</a></li>
      <li><a href="#using-compose_data-to-prepare-a-data-frame-for-the-model">Using <code>compose_data</code> to prepare a data frame for the model</a></li>
      <li><a href="#extracting-draws-from-a-fit-in-tidy-format-using-spread_draws">Extracting draws from a fit in tidy-format using <code>spread_draws</code></a></li>
      <li><a href="#point-summaries-and-intervals-with-the-point_interval-functions-medianmeanmode_qihdi">Point summaries and intervals with the <code>point_interval</code> functions: <code>[median|mean|mode]_[qi|hdi]</code></a></li>
      <li><a href="#plotting-points-and-intervals">Plotting points and intervals</a></li>
      <li><a href="#combining-variables-with-different-indices-in-a-single-tidy-format-data-frame">Combining variables with different indices in a single tidy format data frame</a></li>
      <li><a href="#posterior-predictions">Posterior predictions</a></li>
      <li><a href="#comparing-levels-of-a-factor">Comparing levels of a factor</a></li>
      <li><a href="#gathering-all-model-variable-names-into-a-single-column-gather_draws-and-gather_variables">Gathering all model variable names into a single column: <code>gather_draws</code> and <code>gather_variables</code></a></li>
      <li><a href="#selecting-variables-using-regular-expressions">Selecting variables using regular expressions</a></li>
      <li><a href="#drawing-fit-curves-with-uncertainty">Drawing fit curves with uncertainty</a></li>
      <li><a href="#compatibility-with-other-packages">Compatibility with other packages</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="http://www.mjskay.com">Matthew Kay</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
